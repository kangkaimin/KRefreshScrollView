var theTitleView;

var startTouchTop = 0;
var hasMove = 0; // 已经移动的距离，负责判断是不是在顶端  
var canOperate = true;
var refreshHeight = 100;

function canRefreshObserver(newValue, oldValue, ownerInstance, instance) { 
  if (newValue != undefined) {
    canOperate = newValue; 
  } 
}

function refreshHeightObserver(newValue, oldValue, ownerInstance, instance) {
  if (newValue != undefined) { 
    refreshHeight = newValue;
  }
}

function touchstart(event, ownerInstance) { 

  if (!canOperate) {
    return true;
  }

  theTitleView = ownerInstance.selectComponent('#refreshTitle');

  var bound = event.touches[0];
  var _x = bound.pageX;
  _x = 0;
  var _y = bound.pageY;

  startTouchTop = _y;

  theTitleView.setStyle({
    'height': 0 + 'px',
  });
  return true;
}

function touchmove(event, ownerInstance) {

  if (!canOperate) {
    return true;
  }

  var bound = event.touches[0];
  var _y = bound.pageY;

  // 已经移动的距离
  hasMove = (_y - startTouchTop);

  theTitleView.setStyle({
    'height': hasMove + 'px',
    'line-height': (hasMove > refreshHeight ? refreshHeight : hasMove) + 'px',
    'opacity': (hasMove / refreshHeight)
  });

  return false;
}

function touchend(event, ownerInstance) {
  var bound = event.changedTouches[0];

  var boundX = bound.pageX;
  var boundY = bound.pageY;

  var times = Math.min(boundX, boundY);
  var distanceX = boundX / times;
  var distanceY = boundY / times;

}

function isReady() {
  return "isReady";
}

function bar() {
  return "bar";
}

module.exports = {
  touchmove: touchmove,
  touchend: touchend,
  touchstart: touchstart,
  canRefreshObserver: canRefreshObserver,
  refreshHeightObserver: refreshHeightObserver,
  bar: bar,
  isReady: isReady
}